#!/bin/sh

version="1.3.3"
prefix=/usr/local
packageprefix=""

for opt in "$@" ; do
	case $opt in
	--prefix=*)
		prefix=`echo $opt | sed -n 's/--prefix=\(.*\)/\1/p'`
		;;
	--package-prefix=*)
		packageprefix=`echo $opt | sed -n 's|--package-prefix=\(.*\)|\1|p'`
		;;
	*)
		echo "configure parameter error"
		echo ""
		echo "valid options are:"
		echo "--prefix dir           install to prefix 'dir'"
 		echo "--package-prefix dest  pretend to install to the prefix,"
		echo "                       but copy files to 'dest/prefix' on make install"
		exit
		;;
	esac
done

if test -n "$packageprefix" ; then
    packageprefix="$packageprefix/"
fi

bindir="$packageprefix$prefix/bin"
mandir="$packageprefix$prefix/share/man/man1"

sed -e "s|{BINDIR}|$bindir|g" \
    -e "s|{MANDIR}|$mandir|g" \
    < Makefile.in > Makefile

echo "" > "src/config.h"
echo "#ifndef CKSFV_CONFIG_H" >> "src/config.h"
echo "#define CKSFV_CONFIG_H" >> "src/config.h"

echo "#define VERSION \"$version\"" >> src/config.h

cat > tmpfile.c <<EOF
#include <stdint.h>
#include <stdlib.h>
#include <stdio.h>
int main(void) {return 0;}
EOF
gcc -Wall -O2 -o tmpfile tmpfile.c >/dev/null 2>/dev/null
if test "$?" != "0" ; then
    # no stdint.h. obsolete environment. but we may hope
    echo "#include <unistd.h>" >> src/config.h
    has_stdint="no (you need luck to succeed)"
else
    echo "#include <stdint.h>" >> src/config.h
    has_stdint="yes"
fi

echo "#endif" >> "src/config.h"

echo ""
echo "  prefix directory:          $prefix"
echo "  package prefix:            $packageprefix"
echo "  binary directory:          $bindir"
echo "  man directory:             $mandir"
echo "  has stdint.h:              $has_stdint"
echo ""
echo "configure succesful."
